name: ruster-test

topology:
  nodes:
    # Device Under Test - ruster router
    # Using netshoot for glibc compatibility and network tools
    ruster:
      kind: linux
      image: nicolaka/netshoot
      binds:
        - ../../target/release/ruster:/usr/local/bin/ruster:ro
        - ./config.toml:/etc/ruster/config.toml:ro
      exec:
        # Note: kernel IP forwarding is disabled by default
        # ruster handles all packet forwarding in userspace
        - ip addr add 10.0.1.1/24 dev eth1
        - ip addr add 10.0.2.1/24 dev eth2

    # Client host
    client:
      kind: linux
      image: alpine:3.19
      exec:
        - ip addr add 10.0.1.2/24 dev eth1
        - ip route add 10.0.2.0/24 via 10.0.1.1

    # Server host
    server:
      kind: linux
      image: alpine:3.19
      exec:
        - ip addr add 10.0.2.2/24 dev eth1
        - ip route add 10.0.1.0/24 via 10.0.2.1

  links:
    - endpoints: ["ruster:eth1", "client:eth1"]
    - endpoints: ["ruster:eth2", "server:eth1"]
